#!/bin/bash

# Homebrew Setup Script
# This script installs Homebrew and sets up the environment for package management

set -euo pipefail

echo "Setting up Homebrew..."

# Check if Homebrew is already installed
if command -v brew &> /dev/null; then
    echo "Homebrew is already installed."
else
    echo "Installing Homebrew..."
    # Install Homebrew
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    echo "Homebrew PATH will be configured via .zprofile template"
    # Add Homebrew to PATH temporarily
    echo "Adding Homebrew to PATH temporarily..."
    if [[ $(uname -m) == "arm64" ]]; then
        eval "$(/opt/homebrew/bin/brew shellenv)"
    fi
    if [[ $(uname -m) == "x86_64" ]]; then
        eval "$(/usr/local/bin/brew shellenv)"
    fi

    # Set up Homebrew analytics (optional - you can disable if preferred)
    echo "Disabling brew analytics..."
    brew analytics off
fi

# Update Homebrew and upgrade existing packages
echo "Updating Homebrew and upgrading packages..."

brew update
brew upgrade

# Install packages from Brewfile
echo "Installing packages from Brewfile..."
brew bundle --file=/Users/$(whoami)/Brewfile

# Verify installations
# echo "Verifying installations..."
# brew doctor

# Clean up
echo "Cleaning up..."
brew cleanup

echo "Package installation completed successfully!" 

# Set up Homebrew environment
echo "Setting up Homebrew environment..."

echo "Homebrew setup completed successfully!"
echo "You can now run 'brew bundle' to install packages from your Brewfile." 